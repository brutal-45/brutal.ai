<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BRUTALTOOLS - Ultimate PDF App</title>
    
    <!-- PWA / Native App Meta Tags -->
    <meta name="theme-color" content="#1e1b2e">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="https://picsum.photos/seed/brutal/192/192">
    
    <!-- Embedded PWA Manifest for "Install" capability -->
    <link rel="manifest" href='data:application/manifest+json;base64,ewogICJuYW1lIjogIkJSVVRBTFRPT0xTIiwKICAic2hvcnRfbmFtZSI6ICJCcnV0YWxUb29scyIsCiAgInN0YXJ0X3VybCI6ICIuIiwKICAiZGlzcGxheSI6ICJzdGFuZGFsb25lIiwKICAiYmFja2dyb3VuZF9jb2xvciI6ICIjZjlmYWZiIiwKICAidGhlbWVfY29xvciI6ICIjNkEwREFEIiwKICAiaWNvbnMiOiBbCiAgICB7CiAgICAgICJzcmMiOiAiaHR0cHM6Ly9waWNzdW0ucGhvdG9zL3NlZWQvYnJ1dGFsdG9vbHMvMTkyLzE5MiIsCiAgICAgICJzaXplcyI6ICIxOTJ4MTkyIiwKICAgICAgInR5cGUiOiAiaW1hZ2UvanBnIgogICAgfQogIF0KfQ=='>

    <!-- Icons & Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Libraries -->
    <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    </script>

    <style>
        :root {
            --primary: #6A0DAD;
            --primary-dark: #4b0082;
            --primary-light: #9d4edd;
            --bg-dark: #1e1b2e; /* Deep Navy/Purple */
            --bg-panel: #2a2438; /* Lighter Panel */
            --text-white: #ffffff;
            --text-gray: #a0a0b0;
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            --radius: 16px;
            --header-h: 70px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-white);
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* --- LANDING PAGE (Website View) --- */
        #landing-page {
            flex: 1;
            overflow-y: auto;
            text-align: center;
            background: radial-gradient(circle at 50% 50%, #2d1b4e 0%, var(--bg-dark) 100%);
            display: none; /* Hidden if running as App */
        }
        #landing-page.active { display: block; }

        .hero-section { padding: 6rem 1.5rem; max-width: 800px; margin: 0 auto; }
        .brand-logo { font-size: 3rem; font-weight: 800; color: var(--primary-light); margin-bottom: 1rem; letter-spacing: -2px; text-shadow: 0 0 20px rgba(106,13,173,0.5); }
        .hero-title { font-size: 2.5rem; font-weight: 700; margin-bottom: 1rem; line-height: 1.2; }
        .hero-title span { color: var(--primary); }
        .hero-desc { color: #bbb; font-size: 1.2rem; margin-bottom: 3rem; line-height: 1.6; }

        .download-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            max-width: 1000px;
            margin: 0 auto 4rem;
        }
        .dl-card {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: var(--radius);
            padding: 2rem;
            cursor: pointer;
            transition: 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
        }
        .dl-card:hover { transform: translateY(-5px); border-color: var(--primary); background: rgba(255,255,255,0.1); }
        .os-icon { font-size: 2.5rem; color: var(--text-gray); margin-bottom: 0.5rem; }
        .dl-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 0.8rem 2rem;
            border-radius: 50px;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(106,13,173,0.4);
            transition: 0.3s;
        }
        .dl-btn:hover { background: var(--primary-light); }

        /* --- NATIVE APP VIEW --- */
        #app-view {
            display: none; /* Hidden on Landing Page */
            height: 100%;
            flex-direction: column;
        }
        #app-view.active { display: flex; }

        .app-header {
            height: var(--header-h);
            background: var(--bg-panel);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 1.5rem;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        .app-brand { font-size: 1.4rem; font-weight: 800; color: var(--primary-light); display: flex; align-items: center; gap: 10px; }

        .layout-body { display: flex; flex: 1; overflow: hidden; }

        /* Sidebar */
        .sidebar {
            width: 260px;
            background: rgba(0,0,0,0.3);
            display: flex;
            flex-direction: column;
            padding: 1rem 0;
            overflow-y: auto;
        }

        .nav-item {
            padding: 1rem 1.5rem;
            cursor: pointer;
            transition: 0.2s;
            display: flex;
            align-items: center;
            gap: 15px;
            color: var(--text-gray);
            font-weight: 500;
            border-left: 3px solid transparent;
        }
        .nav-item:hover { background-color: rgba(255,255,255,0.05); color: white; }
        .nav-item.active { background-color: rgba(106, 13, 173, 0.2); color: var(--primary-light); border-left-color: var(--primary); }
        .nav-icon { width: 24px; text-align: center; font-size: 1.1rem; }

        /* Main Content */
        .main-content {
            flex: 1;
            overflow-y: auto;
            background: var(--bg-dark);
            padding: 2rem;
            position: relative;
        }

        .tools-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 1rem;
        }
        .tool-card {
            background: var(--bg-panel);
            border-radius: var(--radius);
            padding: 1.5rem;
            text-align: center;
            cursor: pointer;
            transition: 0.3s;
            border: 1px solid rgba(255,255,255,0.05);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.8rem;
        }
        .tool-card:hover { transform: translateY(-5px); border-color: var(--primary); box-shadow: 0 10px 20px rgba(0,0,0,0.3); }
        .t-icon { font-size: 2rem; color: var(--primary-light); }
        .t-name { font-weight: 600; font-size: 0.95rem; color: white; }

        /* Workspace */
        .workspace {
            display: none;
            height: 100%;
            flex-direction: column;
        }
        .workspace.active { display: flex; }

        .ws-header {
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--bg-panel);
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        
        .drop-zone {
            border: 2px dashed rgba(255,255,255,0.2);
            border-radius: var(--radius);
            padding: 4rem;
            text-align: center;
            cursor: pointer;
            transition: 0.2s;
            margin-bottom: 2rem;
        }
        .drop-zone:hover { border-color: var(--primary); background: rgba(106, 13, 173, 0.05); }
        
        .options-panel {
            background: rgba(255,255,255,0.03);
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            display: none;
        }
        .app-input {
            width: 100%; padding: 0.8rem;
            background: rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 6px;
            color: white;
            font-family: inherit;
            margin-bottom: 0.5rem;
        }
        .app-input:focus { outline: none; border-color: var(--primary); }

        .file-list { display: flex; gap: 1rem; flex-wrap: wrap; min-height: 100px; }
        .file-item {
            background: rgba(255,255,255,0.1);
            padding: 0.5rem 1rem;
            border-radius: 6px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.9rem;
        }
        .del-file { color: #ef4444; cursor: pointer; font-size: 1.2rem; }

        .process-btn {
            width: 100%; padding: 1.2rem;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white; border: none; border-radius: 8px;
            font-size: 1.1rem; font-weight: 700; cursor: pointer;
            box-shadow: 0 4px 15px rgba(106,13,173,0.3);
        }

        /* Mobile */
        @media (max-width: 768px) {
            .sidebar { width: 60px; padding: 1rem 0.5rem; }
            .nav-item { padding: 1rem; }
            .nav-item span { display: none; }
            .nav-item i { font-size: 1.4rem; }
            .tools-grid { grid-template-columns: 1fr 1fr; }
            .download-grid { grid-template-columns: 1fr; }
        }
        @media (min-width: 769px) { .nav-item i { width: 24px; text-align: center; } }
    </style>
</head>
<body>

    <!-- ====== LANDING PAGE (WEBSITE VIEW) ====== -->
    <div id="landing-page" class="active">
        <section class="hero-section">
            <div class="brand-logo">BRUTALTOOLS</div>
            <h1 class="hero-title">The Ultimate <span>PDF Suite</span></h1>
            <p class="hero-desc">Works on Windows, Mac, Linux, Android, and iOS.<br>Offline, Secure, and Blazing Fast.</p>
        </section>

        <section style="padding-bottom: 4rem;">
            <h2 style="color: var(--primary-light); margin-bottom: 2rem;">Download Native App</h2>
            <div class="download-grid">
                <!-- Windows -->
                <div class="dl-card" onclick="downloadSelf('win')">
                    <i class="fa-brands fa-windows os-icon"></i>
                    <span>Windows</span>
                    <button class="dl-btn">Download App</button>
                </div>
                <!-- Mac -->
                <div class="dl-card" onclick="downloadSelf('mac')">
                    <i class="fa-brands fa-apple os-icon"></i>
                    <span>macOS</span>
                    <button class="dl-btn">Download App</button>
                </div>
                <!-- Linux -->
                <div class="dl-card" onclick="downloadSelf('lin')">
                    <i class="fa-brands fa-linux os-icon"></i>
                    <span>Linux</span>
                    <button class="dl-btn">Download App</button>
                </div>
                <!-- Android -->
                <div class="dl-card" onclick="downloadSelf('and')">
                    <i class="fa-brands fa-android os-icon"></i>
                    <span>Android</span>
                    <button class="dl-btn">Download App</button>
                </div>
                <!-- iOS -->
                <div class="dl-card" onclick="downloadSelf('ios')">
                    <i class="fa-brands fa-app-store-ios os-icon"></i>
                    <span>iOS</span>
                    <button class="dl-btn">Download App</button>
                </div>
            </div>
            <p style="margin-top: 2rem; font-size: 0.9rem; color: #666;">
                <i class="fa-solid fa-info-circle"></i> 
                Tip: After downloading, just open the file. It will install automatically as a native app.
            </p>
        </section>
    </div>

    <!-- ====== APP VIEW (NATIVE UI) ====== -->
    <div id="app-view">
        <div class="app-header">
            <div class="app-brand"><i class="fa-solid fa-layer-group"></i> BRUTALTOOLS</div>
            <div style="font-size: 0.8rem; color: var(--text-gray);">v1.0 â€¢ Offline</div>
        </div>

        <div class="layout-body">
            <!-- Sidebar -->
            <nav class="sidebar">
                <div class="nav-item active" onclick="filter('all', this)"><i class="fa-solid fa-grip"></i> <span>All Tools</span></div>
                <div class="nav-item" onclick="filter('org', this)"><i class="fa-solid fa-layer-group"></i> <span>Organize</span></div>
                <div class="nav-item" onclick="filter('conv', this)"><i class="fa-solid fa-arrow-right-arrow-left"></i> <span>Convert</span></div>
                <div class="nav-item" onclick="filter('opt', this)"><i class="fa-solid fa-sliders"></i> <span>Options</span></div>
                <div class="nav-item" onclick="filter('sec', this)"><i class="fa-solid fa-shield-halved"></i> <span>Security</span></div>
            </nav>

            <!-- Main Workspace -->
            <main class="main-content">
                
                <!-- Tools Grid -->
                <div class="tools-grid" id="toolsGrid">
                    <!-- Injected via JS -->
                </div>

                <!-- Active Tool Workspace -->
                <div class="workspace" id="workspace">
                    <div class="ws-header">
                        <button onclick="showDashboard()" style="background:none; border:none; color:white; font-size:1.5rem; cursor:pointer;"><i class="fa-solid fa-arrow-left"></i></button>
                        <h3 id="wsTitle" style="margin:0;">Tool</h3>
                    </div>
                    
                    <div style="padding: 2rem;">
                        <!-- Dynamic Options -->
                        <div id="toolOptions" class="options-panel"></div>

                        <!-- Upload Area -->
                        <div class="drop-zone" id="dropZone" onclick="triggerInput()">
                            <i class="fa-solid fa-cloud-arrow-up" style="font-size: 2.5rem; color: var(--text-gray); margin-bottom: 1rem;"></i>
                            <h3>Select File</h3>
                            <input type="file" id="fileInput" multiple style="display:none;">
                        </div>

                        <!-- File List -->
                        <div id="fileList" class="file-list" style="display:none;"></div>

                        <!-- Process Action -->
                        <button class="process-btn" onclick="process()">Process & Save</button>
                    </div>
                </div>

            </main>
        </div>
    </div>

    <script>
        // --- 13 TOOLS DATA ---
        const tools = [
            { id: 'merge', cat: 'org', icon: 'fa-layer-group', name: 'Merge PDF' },
            { id: 'split', cat: 'org', icon: 'fa-scissors', name: 'Split PDF' },
            { id: 'rotate', cat: 'org', icon: 'fa-rotate-right', name: 'Rotate PDF' },
            { id: 'pagenumbers', cat: 'org', icon: 'fa-list-ol', name: 'Page Numbers' },
            { id: 'header', cat: 'org', icon: 'fa-heading', name: 'Add Header' },
            { id: 'footer', cat: 'org', icon: 'fa-paragraph', name: 'Add Footer' },
            
            { id: 'img2pdf', cat: 'conv', icon: 'fa-image', name: 'Image to PDF' },
            { id: 'pdf2img', cat: 'conv', icon: 'fa-file-image', name: 'PDF to Image' },
            
            { id: 'compress', cat: 'opt', icon: 'fa-compress', name: 'Compress PDF' },
            { id: 'resize', cat: 'opt', icon: 'fa-expand', name: 'Resize PDF' },
            
            { id: 'watermark', cat: 'sec', icon: 'fa-copyright', name: 'Watermark' },
            { id: 'protect', cat: 'sec', icon: 'fa-lock', name: 'Protect' },
            { id: 'unlock', cat: 'sec', icon: 'fa-unlock', name: 'Unlock' },
            { id: 'sign', cat: 'sec', icon: 'fa-signature', name: 'Sign PDF' }
        ];

        let currentTool = null;
        let files = [];

        // --- VIEW SWITCHER (Landing vs App) ---
        window.onload = () => {
            // If opened as file (file://), show App View immediately
            // If opened via http (Website), show Landing Page
            if (window.location.protocol === 'file:') {
                document.getElementById('landing-page').classList.remove('active');
                document.getElementById('app-view').classList.add('active');
                initApp();
            }
        };

        function downloadSelf(os) {
            // Download the current HTML file
            const htmlContent = document.documentElement.outerHTML;
            const blob = new Blob([htmlContent], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `BRUTALTOOLS_Native_App.html`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            alert("App Downloaded!\n\nWhen you open this file, BRUTALTOOLS will launch as a Native App.");
        }

        // --- APP LOGIC ---
        function initApp() {
            renderGrid('all');
        }

        function renderGrid(filter) {
            const grid = document.getElementById('toolsGrid');
            grid.innerHTML = '';
            const list = filter === 'all' ? tools : tools.filter(t => t.cat === filter);
            list.forEach(t => {
                const card = document.createElement('div');
                card.className = 'tool-card';
                card.innerHTML = `<div class="t-icon"><i class="fa-solid ${t.icon}"></i></div><div class="t-name">${t.name}</div>`;
                card.onclick = () => openTool(t);
                grid.appendChild(card);
            });
        }

        function filter(cat, btn) {
            document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
            if(btn) btn.classList.add('active');
            renderGrid(cat);
        }

        function showDashboard() {
            document.getElementById('toolsGrid').style.display = 'grid';
            document.getElementById('workspace').classList.remove('active');
            files = [];
        }

        function openTool(tool) {
            currentTool = tool;
            document.getElementById('toolsGrid').style.display = 'none';
            document.getElementById('workspace').classList.add('active');
            document.getElementById('wsTitle').innerText = tool.name;
            
            // Reset UI
            const opts = document.getElementById('toolOptions');
            opts.style.display = 'none'; opts.innerHTML = '';
            
            // Dynamic Options
            if(['resize'].includes(tool.id)) {
                opts.style.display = 'block';
                opts.innerHTML = `<input type="number" id="scaleInput" class="app-input" value="0.8" step="0.1" placeholder="Scale (e.g. 0.5 for 50%)">`;
            } 
            else if(['header','footer'].includes(tool.id)) {
                opts.style.display = 'block';
                opts.innerHTML = `<input type="text" id="textInput" class="app-input" placeholder="Enter text here...">`;
            }
            else if(['sign'].includes(tool.id)) {
                opts.style.display = 'block';
                opts.innerHTML = `<input type="file" id="signInput" class="app-input" accept="image/*">`;
            }
            else if(['watermark'].includes(tool.id)) {
                opts.style.display = 'block';
                opts.innerHTML = `<input type="text" id="wmInput" class="app-input" value="CONFIDENTIAL">`;
            }
            else if(['protect','unlock'].includes(tool.id)) {
                opts.style.display = 'block';
                opts.innerHTML = `<input type="password" id="passInput" class="app-input" placeholder="Password...">`;
            }

            // File Input Setup
            const fInput = document.getElementById('fileInput');
            if(tool.id === 'img2pdf') fInput.accept = 'image/*';
            else fInput.accept = '.pdf';
        }

        function triggerInput() { document.getElementById('fileInput').click(); }
        
        document.getElementById('fileInput').addEventListener('change', (e) => {
            files = Array.from(e.target.files);
            const list = document.getElementById('fileList');
            list.innerHTML = '';
            list.style.display = files.length ? 'flex' : 'none';

            files.forEach(f => {
                const div = document.createElement('div');
                div.className = 'file-item';
                div.innerHTML = `<i class="fa-solid fa-file-pdf"></i> ${f.name} <i class="fa-solid fa-times del-file"></i>`;
                div.querySelector('.del-file').onclick = () => { 
                    div.remove(); 
                    files = files.filter(x => x !== f); 
                };
                list.appendChild(div);
            });
        });

        // --- PROCESSING ENGINE ---
        async function process() {
            if(files.length === 0) return alert("Please select a file.");
            
            const btn = document.querySelector('.process-btn');
            const originalText = btn.innerText;
            btn.innerText = "Processing...";
            btn.disabled = true;

            try {
                const { PDFDocument, rgb, degrees, StandardFonts } = PDFLib;
                let result;

                // 1. MERGE
                if(currentTool.id === 'merge') {
                    const merged = await PDFDocument.create();
                    for(let f of files) {
                        const src = await PDFDocument.load(await f.arrayBuffer());
                        const pages = await merged.copyPages(src, src.getPageIndices());
                        pages.forEach(p => merged.addPage(p));
                    }
                    result = await merged.save();
                }
                // 2. SPLIT
                else if(currentTool.id === 'split') {
                    const zip = new JSZip();
                    const src = await PDFDocument.load(await files[0].arrayBuffer());
                    for(let i=0; i<src.getPageCount(); i++) {
                        const newPdf = await PDFDocument.create();
                        const [page] = await newPdf.copyPages(src, [i]);
                        newPdf.addPage(page);
                        zip.file(`page_${i+1}.pdf`, await newPdf.save());
                    }
                    result = await zip.generateAsync({type:"blob"});
                }
                // 3. ROTATE
                else if(currentTool.id === 'rotate') {
                    const src = await PDFDocument.load(await files[0].arrayBuffer());
                    src.getPages().forEach(p => p.setRotation(degrees(90)));
                    result = await src.save();
                }
                // 4. NUMBERS
                else if(currentTool.id === 'pagenumbers') {
                    const src = await PDFDocument.load(await files[0].arrayBuffer());
                    const font = await src.embedFont(StandardFonts.Helvetica);
                    src.getPages().forEach((page, i) => {
                        page.drawText(`${i+1}`, { x: 50, y: 30, size: 12, font, color: rgb(1,1,1) });
                    });
                    result = await src.save();
                }
                // 5. HEADER
                else if(currentTool.id === 'header') {
                    const text = document.getElementById('textInput').value;
                    const src = await PDFDocument.load(await files[0].arrayBuffer());
                    const font = await src.embedFont(StandardFonts.HelveticaBold);
                    src.getPages().forEach(page => {
                        const { width } = page.getSize();
                        page.drawText(text, { x: width/2 - (text.length*8), y: page.getHeight() - 40, size: 20, font, color: rgb(1,1,1) });
                    });
                    result = await src.save();
                }
                // 6. FOOTER
                else if(currentTool.id === 'footer') {
                    const text = document.getElementById('textInput').value;
                    const src = await PDFDocument.load(await files[0].arrayBuffer());
                    const font = await src.embedFont(StandardFonts.Helvetica);
                    src.getPages().forEach(page => {
                        page.drawText(text, { x: 50, y: 30, size: 12, font, color: rgb(1,1,1) });
                    });
                    result = await src.save();
                }
                // 7. IMG2PDF
                else if(currentTool.id === 'img2pdf') {
                    const doc = await PDFDocument.create();
                    for(let f of files) {
                        let img = f.type === 'image/jpeg' ? await doc.drawJpg(await f.arrayBuffer()) : await doc.drawPng(await f.arrayBuffer());
                        const page = doc.addPage();
                        page.drawImage(img, { x: 0, y: 0, width: page.getWidth(), height: page.getHeight() });
                    }
                    result = await doc.save();
                }
                // 8. PDF2IMG
                else if(currentTool.id === 'pdf2img') {
                    const zip = new JSZip();
                    const srcBytes = await files[0].arrayBuffer();
                    const pdf = await pdfjsLib.getDocument(srcBytes).promise;
                    for(let i=1; i<=pdf.numPages; i++) {
                        const page = await pdf.getPage(i);
                        const viewport = page.getViewport({ scale: 1.5 });
                        const canvas = document.createElement('canvas');
                        canvas.width = viewport.width; canvas.height = viewport.height;
                        await page.render({ canvasContext: canvas.getContext('2d'), viewport }).promise;
                        const blob = await new Promise(r => canvas.toBlob(r, 'image/jpeg', 0.8));
                        zip.file(`page_${i}.jpg`, blob);
                    }
                    result = await zip.generateAsync({type:"blob"});
                }
                // 9. COMPRESS
                else if(currentTool.id === 'compress') {
                    const src = await PDFDocument.load(await files[0].arrayBuffer());
                    result = await src.save({ useObjectStreams: true });
                }
                // 10. RESIZE
                else if(currentTool.id === 'resize') {
                    const scale = parseFloat(document.getElementById('scaleInput').value) || 0.8;
                    const src = await PDFDocument.load(await files[0].arrayBuffer());
                    const pages = src.getPages();
                    for(let i=0; i<pages.length; i++) {
                        const { width, height } = pages[i].getSize();
                        pages[i].setWidth(width * scale);
                        pages[i].setHeight(height * scale);
                    }
                    result = await src.save();
                }
                // 11. WATERMARK
                else if(currentTool.id === 'watermark') {
                    const text = document.getElementById('wmInput').value;
                    const src = await PDFDocument.load(await files[0].arrayBuffer());
                    const font = await src.embedFont(StandardFonts.HelveticaBold);
                    src.getPages().forEach(page => {
                        const { width, height } = page.getSize();
                        page.drawText(text, { x: width/2 - (text.length*8), y: height/2, size: 50, font, color: rgb(0.8,0.8,0.8), opacity: 0.5, rotate: degrees(45) });
                    });
                    result = await src.save();
                }
                // 12. PROTECT
                else if(currentTool.id === 'protect') {
                    const pass = document.getElementById('passInput').value;
                    if(!pass) throw new Error("Enter password");
                    const src = await PDFDocument.load(await files[0].arrayBuffer());
                    result = await src.save({ userPassword: pass });
                }
                // 13. UNLOCK
                else if(currentTool.id === 'unlock') {
                    const pass = document.getElementById('passInput').value;
                    const src = await PDFDocument.load(await files[0].arrayBuffer(), { password: pass });
                    result = await src.save();
                }
                // 14. SIGN
                else if(currentTool.id === 'sign') {
                    const signFile = document.getElementById('signInput').files[0];
                    if(!signFile) throw new Error("Upload signature image");
                    const signBytes = await signFile.arrayBuffer();
                    let signImg;
                    if(signFile.type === 'image/jpeg') signImg = await (await PDFDocument.create()).drawJpg(signBytes);
                    else signImg = await (await PDFDocument.create()).drawPng(signBytes);
                    
                    const src = await PDFDocument.load(await files[0].arrayBuffer());
                    const pages = src.getPages();
                    for(let i=0; i<pages.length; i++) {
                        const page = pages[i];
                        const { width, height } = page.getSize();
                        page.drawImage(signImg, { x: width - 100, y: 50, width: 80, height: 40, opacity: 0.8 });
                    }
                    result = await src.save();
                }

                // NATIVE SAVE
                const blob = new Blob([result], {type: currentTool.id === 'pdf2img' ? 'application/zip' : 'application/pdf'});
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `Brutal_${currentTool.id}.${currentTool.id === 'pdf2img' ? 'zip' : 'pdf'}`;
                a.click();
                
                btn.innerText = "Saved!";
                setTimeout(() => { btn.innerText = originalText; btn.disabled = false; }, 2000);

            } catch(e) {
                alert("Error: " + e.message);
                btn.innerText = originalText;
                btn.disabled = false;
            }
        }
    </script>
</body>
</html>
